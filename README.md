# Beancount Docker

è¿™æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå’Œè¿è¡ŒBeancountçš„Dockerå®¹å™¨é¡¹ç›®ã€‚Beancountæ˜¯ä¸€ä¸ªåŸºäºå¤å¼è®°è´¦çš„ä¸ªäººè´¢åŠ¡ç®¡ç†å·¥å…·ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ³ å®Œæ•´çš„DockeråŒ–Beancountç¯å¢ƒ
- ğŸŒ åŒ…å«Fava Webç•Œé¢ï¼Œæ”¯æŒå¯è§†åŒ–è´¦æœ¬ç®¡ç†
- ğŸ“Š æ”¯æŒæ•°æ®å¯¼å…¥å’Œåˆ†æå·¥å…·
- ğŸ”§ è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
- ğŸ“ æ•°æ®æŒä¹…åŒ–æ”¯æŒ
- ğŸš€ GitHub Actionsè‡ªåŠ¨æ„å»ºå¹¶æ¨é€åˆ°Docker Hub

## CI/CDè‡ªåŠ¨åŒ–

æœ¬é¡¹ç›®é…ç½®äº†GitHub Actionsï¼Œå¯ä»¥è‡ªåŠ¨æ„å»ºDockeré•œåƒå¹¶æ¨é€åˆ°Docker Hubã€‚

### é…ç½®Docker Hubè‡ªåŠ¨æ¨é€

è¦å¯ç”¨è‡ªåŠ¨æ¨é€åˆ°Docker Hubï¼Œéœ€è¦åœ¨GitHubä»“åº“ä¸­é…ç½®ä»¥ä¸‹Secretsï¼š

1. è®¿é—®ä½ çš„GitHubä»“åº“ â†’ Settings â†’ Secrets and variables â†’ Actions
2. æ·»åŠ ä»¥ä¸‹Repository secretsï¼š
   - `DOCKERHUB_USERNAME`: ä½ çš„Docker Hubç”¨æˆ·å
   - `DOCKERHUB_TOKEN`: ä½ çš„Docker Hubè®¿é—®ä»¤ç‰Œ

### è·å–Docker Hub Token

1. ç™»å½• [Docker Hub](https://hub.docker.com/)
2. ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ Account Settings
3. é€‰æ‹© Security â†’ New Access Token
4. åˆ›å»ºä¸€ä¸ªæ–°çš„è®¿é—®ä»¤ç‰Œï¼ˆæƒé™é€‰æ‹© Read, Write, Deleteï¼‰
5. å¤åˆ¶ç”Ÿæˆçš„ä»¤ç‰Œå¹¶ä¿å­˜åˆ°GitHub Secretsä¸­

### è‡ªåŠ¨æ„å»ºè§¦å‘æ¡ä»¶

GitHub Actionsä¼šåœ¨ä»¥ä¸‹æƒ…å†µä¸‹è‡ªåŠ¨æ„å»ºå’Œæ¨é€é•œåƒï¼š

- æ¨é€åˆ° `main` æˆ– `master` åˆ†æ”¯
- åˆ›å»ºæ–°çš„æ ‡ç­¾ï¼ˆæ ¼å¼ï¼š`v*`ï¼‰
- åˆ›å»º Pull Requestï¼ˆä»…æ„å»ºï¼Œä¸æ¨é€ï¼‰

### é•œåƒæ ‡ç­¾

è‡ªåŠ¨æ„å»ºä¼šç”Ÿæˆä»¥ä¸‹æ ‡ç­¾ï¼š

- `latest`: æœ€æ–°çš„mainåˆ†æ”¯ç‰ˆæœ¬
- `{branch-name}`: åˆ†æ”¯åæ ‡ç­¾
- `{tag}`: å¯¹åº”çš„Gitæ ‡ç­¾
- `{major}.{minor}`: ç‰ˆæœ¬å·æ ‡ç­¾ï¼ˆå¦‚æœæ˜¯è¯­ä¹‰åŒ–ç‰ˆæœ¬æ ‡ç­¾ï¼‰

## å¿«é€Ÿå¼€å§‹

### ä½¿ç”¨é¢„æ„å»ºé•œåƒï¼ˆæ¨èï¼‰

å¦‚æœé¡¹ç›®å·²é…ç½®è‡ªåŠ¨æ„å»ºï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Docker Hubä¸Šçš„é•œåƒï¼š

```bash
# æ‹‰å–æœ€æ–°é•œåƒ
docker pull your-dockerhub-username/beancount-docker:latest

# è¿è¡Œå®¹å™¨
docker run -d \
  --name beancount \
  -p 6000:6000 \
  -v $(pwd)/data:/data \
  your-dockerhub-username/beancount-docker:latest
```

### ä½¿ç”¨æ„å»ºè„šæœ¬ï¼ˆæœ¬åœ°æ„å»ºï¼‰

1. **æ„å»ºDockeré•œåƒ**
   ```bash
   ./build.sh build
   ```

2. **è¿è¡Œå®¹å™¨**
   ```bash
   ./build.sh run
   ```

3. **è®¿é—®Webç•Œé¢**
   
   æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:6000

### ä½¿ç”¨Docker Compose

1. **å¯åŠ¨æœåŠ¡**
   ```bash
   docker-compose up -d
   ```

2. **åœæ­¢æœåŠ¡**
   ```bash
   docker-compose down
   ```

## è„šæœ¬å‘½ä»¤

æ„å»ºè„šæœ¬ `build.sh` æ”¯æŒä»¥ä¸‹å‘½ä»¤ï¼š

- `build` - æ„å»ºDockeré•œåƒ
- `run` - è¿è¡ŒBeancountå®¹å™¨
- `stop` - åœæ­¢å®¹å™¨
- `clean` - æ¸…ç†å®¹å™¨å’Œé•œåƒ
- `logs` - æŸ¥çœ‹å®¹å™¨æ—¥å¿—
- `shell` - è¿›å…¥å®¹å™¨shell
- `help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

### ç¤ºä¾‹

```bash
# æ„å»ºé•œåƒ
./build.sh build

# è¿è¡Œå®¹å™¨
./build.sh run

# æŸ¥çœ‹æ—¥å¿—
./build.sh logs

# è¿›å…¥å®¹å™¨shellè¿›è¡Œè°ƒè¯•
./build.sh shell

# åœæ­¢å®¹å™¨
./build.sh stop

# æ¸…ç†æ‰€æœ‰èµ„æº
./build.sh clean
```

## ç›®å½•ç»“æ„

```
beancount-docker/
â”œâ”€â”€ Dockerfile              # Dockeré•œåƒå®šä¹‰
â”œâ”€â”€ docker-compose.yml      # Docker Composeé…ç½®
â”œâ”€â”€ build.sh                # æ„å»ºå’Œç®¡ç†è„šæœ¬
â”œâ”€â”€ requirements.txt        # Pythonä¾èµ–
â”œâ”€â”€ .dockerignore           # Dockeræ„å»ºå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ docker-build-push.yml  # GitHub Actionså·¥ä½œæµ
â”œâ”€â”€ data/                   # è´¦æœ¬æ•°æ®ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â””â”€â”€ main.beancount      # ç¤ºä¾‹è´¦æœ¬æ–‡ä»¶
â””â”€â”€ README.md              # é¡¹ç›®æ–‡æ¡£
```

## æ•°æ®ç®¡ç†

### è´¦æœ¬æ–‡ä»¶

è´¦æœ¬æ–‡ä»¶å­˜å‚¨åœ¨ `./data/` ç›®å½•ä¸­ï¼Œè¯¥ç›®å½•ä¼šè‡ªåŠ¨æŒ‚è½½åˆ°å®¹å™¨å†…çš„ `/data` ç›®å½•ã€‚

é»˜è®¤çš„ä¸»è´¦æœ¬æ–‡ä»¶æ˜¯ `./data/main.beancount`ï¼Œä½ å¯ä»¥ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶æ¥ç®¡ç†ä½ çš„è´¢åŠ¡è®°å½•ã€‚

### æ•°æ®æŒä¹…åŒ–

æ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨å®¿ä¸»æœºçš„ `./data/` ç›®å½•ä¸­ï¼Œå®¹å™¨é‡å¯åæ•°æ®ä¸ä¼šä¸¢å¤±ã€‚

## è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹ç«¯å£

é»˜è®¤ç«¯å£æ˜¯6000ï¼Œå¦‚éœ€ä¿®æ”¹ï¼Œå¯ä»¥ï¼š

1. ç¼–è¾‘ `build.sh` è„šæœ¬ä¸­çš„ç«¯å£æ˜ å°„
2. æˆ–è€…ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£é…ç½®

### æ·»åŠ æ›´å¤šå·¥å…·

åœ¨ `requirements.txt` ä¸­æ·»åŠ é¢å¤–çš„PythonåŒ…ï¼Œç„¶åé‡æ–°æ„å»ºé•œåƒã€‚

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¯¼å…¥é“¶è¡Œå¯¹è´¦å•ï¼Ÿ

A: è¿›å…¥å®¹å™¨shell (`./build.sh shell`) åï¼Œå¯ä»¥ä½¿ç”¨beancount-importç­‰å·¥å…·å¯¼å…¥å„ç§æ ¼å¼çš„æ•°æ®ã€‚

### Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ

A: ç›´æ¥å¤‡ä»½ `./data/` ç›®å½•å³å¯ï¼Œè¿™åŒ…å«äº†æ‰€æœ‰çš„è´¦æœ¬æ–‡ä»¶ã€‚

### Q: å®¹å™¨å¯åŠ¨å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: è¿è¡Œ `./build.sh logs` æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚

### Q: GitHub Actionsæ„å»ºå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹é…ç½®ï¼š
1. ç¡®è®¤GitHub Secretsä¸­çš„Docker Hubå‡­æ®æ­£ç¡®
2. æ£€æŸ¥Docker Hubç”¨æˆ·åæ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹Actionsæ—¥å¿—äº†è§£å…·ä½“é”™è¯¯ä¿¡æ¯

## å¼€å‘

å¦‚éœ€ä¿®æ”¹Dockerfileæˆ–æ·»åŠ æ–°åŠŸèƒ½ï¼š

1. ä¿®æ”¹ç›¸åº”æ–‡ä»¶
2. é‡æ–°æ„å»ºé•œåƒ: `./build.sh build`
3. æµ‹è¯•æ–°åŠŸèƒ½: `./build.sh run`

### ç‰ˆæœ¬å‘å¸ƒ

è¦å‘å¸ƒæ–°ç‰ˆæœ¬å¹¶è‡ªåŠ¨æ„å»ºDockeré•œåƒï¼š

```bash
# åˆ›å»ºå¹¶æ¨é€æ ‡ç­¾
git tag v1.0.0
git push origin v1.0.0
```

è¿™å°†è§¦å‘GitHub Actionsè‡ªåŠ¨æ„å»ºå¹¶æ¨é€å¸¦æœ‰ç‰ˆæœ¬æ ‡ç­¾çš„é•œåƒã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ä¸åŸå§‹Beancounté¡¹ç›®ç›¸åŒçš„è®¸å¯è¯ã€‚

## ç›¸å…³é“¾æ¥

- [Beancountå®˜æ–¹æ–‡æ¡£](https://beancount.github.io/docs/)
- [Favaé¡¹ç›®](https://github.com/beancount/fava)
- [Beancountä¸­æ–‡æ–‡æ¡£](https://beancount.github.io/docs/index_cn.html)
- [Docker Hub](https://hub.docker.com/)